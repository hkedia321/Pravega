!function(t){var i=function(){for(var t=["webkit","moz","ms"],i=document.createElement("div").style,e=("transform"in i?"transform":void 0),n=0,s=t.length;s>n;n++){var o=t[n]+"Transform";if(o in i){e=o;break}}return e}(),e=function(e,n){if(e.item=this,this.element=e,"IMG"===e.tagName?(this.fullWidth=e.width,this.fullHeight=e.height):(e.style.display="inline-block",this.fullWidth=e.offsetWidth,this.fullHeight=e.offsetHeight),e.style.position="absolute",n.mirror&&"IMG"===this.element.tagName){this.reflection=t(e).reflect(n.mirror).next()[0];var s=t(this.reflection);this.reflection.fullHeight=s.height(),s.css("margin-top",n.mirror.gap+"px"),s.css("width","100%"),e.style.width="100%",this.element=this.element.parentNode,this.element.item=this,this.element.alt=e.alt,this.element.title=e.title}i&&n.transforms&&(this.element.style[i+"Origin"]="0 0"),this.moveTo=function(t,e,s){this.width=this.fullWidth*s,this.height=this.fullHeight*s,this.x=t,this.y=e,this.scale=s;var o=this.element.style;o.zIndex=""+100*s|0,i&&n.transforms?o[i]="translate("+t+"px, "+e+"px) scale("+s+")":(n.mirror&&"IMG"===this.element.tagName&&(this.reflection.style.marginTop=n.mirror.gap*s+"px"),o.width=this.width+"px",o.left=t+"px",o.top=e+"px")}},n=window.performance&&window.performance.now?function(){return performance.now()}:function(){return+new Date},s=window.cancelAnimationFrame||window.cancelRequestAnimationFrame,o=window.requestAnimationFrame;!function(){for(var t=["webkit","moz","ms"],i=0,e=t.length;e>i&&!s;i++)s=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"],o=o&&window[t[i]+"RequestAnimationFrame"]}();var a=function(i,a){var h=this,r=t(i);this.items=[],this.xOrigin=null===a.xOrigin?.5*r.width():a.xOrigin,this.yOrigin=null===a.yOrigin?.1*r.height():a.yOrigin,this.xRadius=null===a.xRadius?r.width()/2.3:a.xRadius,this.yRadius=null===a.yRadius?r.height()/6:a.yRadius,this.farScale=a.farScale,this.rotation=this.destRotation=Math.PI/2,this.speed=a.speed,this.smooth=a.smooth,this.fps=a.fps,this.timer=0,this.autoPlayAmount=a.autoPlay,this.autoPlayDelay=a.autoPlayDelay,this.autoPlayTimer=0,this.onLoaded=a.onLoaded,this.onRendered=a.onRendered,this.onAnimationFinished=a.onAnimationFinished,this.itemOptions={transforms:a.transforms},a.mirror&&(this.itemOptions.mirror=t.extend({gap:2},a.mirror)),r.css({position:"relative",overflow:"hidden"}),this.renderItem=function(t,i){var e=this.items[t],n=Math.sin(i),s=this.farScale,o=s+(1-s)*(n+1)*.5;e.moveTo(this.xOrigin+o*(Math.cos(i)*this.xRadius-.5*e.fullWidth),this.yOrigin+o*n*this.yRadius,o)},this.render=function(){for(var t=this.items.length,i=2*Math.PI/t,e=this.rotation,n=0;t>n;n++)this.renderItem(n,e),e+=i;"function"==typeof this.onRendered&&this.onRendered(this)},this.playFrame=function(){var t=h.destRotation-h.rotation,i=n(),e=.002*(i-h.lastTime);h.lastTime=i,Math.abs(t)<.003?(h.rotation=h.destRotation,h.pause(),"function"==typeof h.onAnimationFinished&&h.onAnimationFinished()):(h.rotation=h.destRotation-t/(1+h.speed*e),h.scheduleNextFrame()),h.render()},this.scheduleNextFrame=function(){this.lastTime=n(),this.timer=this.smooth&&s?o(h.playFrame):setTimeout(h.playFrame,1e3/this.fps)},this.itemsRotated=function(){return this.items.length*(Math.PI/2-this.rotation)/(2*Math.PI)},this.floatIndex=function(){var t=this.items.length,i=this.itemsRotated()%t;return 0>i?i+t:i},this.nearestIndex=function(){return Math.round(this.floatIndex())%this.items.length},this.nearestItem=function(){return this.items[this.nearestIndex()]},this.play=function(){0===this.timer&&this.scheduleNextFrame()},this.pause=function(){this.smooth&&s?s(this.timer):clearTimeout(this.timer),this.timer=0},this.go=function(t){this.destRotation+=2*Math.PI/this.items.length*t,this.play()},this.deactivate=function(){this.pause(),clearInterval(this.autoPlayTimer),a.buttonLeft&&a.buttonLeft.unbind("click"),a.buttonRight&&a.buttonRight.unbind("click"),r.unbind(".cloud9")},this.autoPlay=function(){this.autoPlayTimer=setInterval(function(){h.go(h.autoPlayAmount)},this.autoPlayDelay)},this.enableAutoPlay=function(){r.bind("mouseover.cloud9",function(){clearInterval(h.autoPlayTimer)}),r.bind("mouseout.cloud9",function(){h.autoPlay()}),this.autoPlay()},this.bindControls=function(){a.buttonLeft&&a.buttonLeft.bind("click",function(){return h.go(-1),!1}),a.buttonRight&&a.buttonRight.bind("click",function(){return h.go(1),!1}),a.mouseWheel&&r.bind("mousewheel.cloud9",function(t,i){return h.go(i>0?1:-1),!1}),a.bringToFront&&r.bind("click.cloud9",function(i){var e=t(i.target).closest("."+a.itemClass);if(0!==e.length){var n=h.items.indexOf(e[0].item),s=h.items.length,o=n-h.floatIndex()%s;2*Math.abs(o)>s&&(o+=o>0?-s:s),Math.abs(o)>.5&&i.preventDefault(),h.destRotation=h.rotation,h.go(-o)}})};var l=r.find("."+a.itemClass);this.finishInit=function(){for(var t=0;t<l.length;t++){var i=l[t];if("IMG"===i.tagName&&(void 0===i.width||void 0!==i.complete&&!i.complete))return}for(clearInterval(this.initTimer),t=0;t<l.length;t++)this.items.push(new e(l[t],this.itemOptions));r.bind("mousedown onselectstart",function(){return!1}),0!==this.autoPlayAmount&&this.enableAutoPlay(),this.bindControls(),this.render(),"function"==typeof this.onLoaded&&this.onLoaded(this)},this.initTimer=setInterval(function(){h.finishInit()},50)};t.fn.Cloud9Carousel=function(i){return this.each(function(){i=t.extend({xOrigin:null,yOrigin:null,xRadius:null,yRadius:null,farScale:.5,transforms:!0,smooth:!0,fps:30,speed:4,autoPlay:0,autoPlayDelay:4e3,bringToFront:!1,itemClass:"cloud9-item",handle:"carousel"},i),t(this).data(i.handle,new a(this,i))})}}(window.jQuery||window.Zepto);